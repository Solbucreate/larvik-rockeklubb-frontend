<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kjøp billett – Sabaton</title>

<style>
:root { --ikonfarge: #cfcfcf; }
body { font-family: Arial, sans-serif; background:#111; color:#eee; margin:0; }

header {
  background:#1a1a1a;
  padding:8px 20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom:2px solid #e63946;
  position:relative;
  z-index:100;
}

header img { max-height:90px; }
.logo-left { max-height:90px; }
.logo-center {
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  top:30px;
  max-height:45px;
  filter: drop-shadow(0 0 3px rgba(180,200,255,0.6))
          drop-shadow(0 0 8px rgba(200,220,255,0.7));
  animation: glowWhiteCool 6s ease-in-out infinite;
}

/* Kald hvit neonglød */
@keyframes glowWhiteCool {
  0% { filter: drop-shadow(0 0 3px rgba(180,200,255,0.6)) drop-shadow(0 0 8px rgba(200,220,255,0.7)); }
  50% { filter: drop-shadow(0 0 6px rgba(200,230,255,0.9)) drop-shadow(0 0 14px rgba(210,240,255,1)); }
  100% { filter: drop-shadow(0 0 3px rgba(180,200,255,0.6)) drop-shadow(0 0 8px rgba(200,220,255,0.7)); }
}

.burger{cursor:pointer;width:25px;height:18px;position:absolute;bottom:15px;right:20px;z-index:100;}
.burger span{position:absolute;height:4px;width:100%;background:#e63946;border-radius:2px;left:0;transition:0.3s;}
.burger span:nth-child(1){top:0;}
.burger span:nth-child(2){top:9px;}
.burger span:nth-child(3){top:18px;}

.menu{display:none;position:absolute;top:75px;right:20px;background:#1a1a1a;border:2px solid #e63946;border-radius:6px;overflow:hidden;}
.menu a{display:block;padding:10px 20px;color:#eee;text-decoration:none;}
.menu a:hover{background:#e63946;color:#111;}
.show{display:block;}

h1{text-align:center;font-size:2rem;margin-bottom:30px;color:#fff;text-shadow:0 0 10px rgba(255,255,255,0.5);}
.container{background:#1a1a1a;padding:25px 30px;border-radius:10px;box-shadow: 0 0 60px rgba(228,32,32,0.432);max-width:440px;margin:0 auto;text-align:left;}
label{display:block;margin-top:15px;font-weight:bold;margin-left:10%;}
input[type=text],input { width:50%;padding:8px;border-radius:5px;border:1px solid #ffffff;background:#222;color:#fff;margin-top:5px;margin-left:11.5%;text-align:left;}
input[type=email],input{ width:50%;padding:8px;border-radius:5px;border:1px solid #ffffff;background:#222;color:#fff;margin-top:5px;margin-left:9%;text-align:left;}
input[type=tel],input { width: 50%; padding: 8px; border-radius: 5px; border: 1px solid #ffffff; background: #222; color: #fff; margin-top: 5px; margin-left: 10.7%; box-sizing: border-box;}
input[type=age],input { width: 70px; padding: 8px; border-radius: 5px; border: 1px solid #ffffff; background: #222; color: #fff; margin-top: 5px; margin-left: 10.5%; text-align: left;}

/* === KNAPP MIDTSTILT === */
form button {
  display: block;
  margin: 25px auto 0 auto;
}

/* --- BILLETTKNAPP (3D) --- */
.billett-knapp {
  display:inline-block;
  text-transform:uppercase;
  text-decoration:none;
  color:#fff;
  background:linear-gradient(180deg,#2a2a2a 0%,#101010 100%);
  border:1px solid #000;
  border-radius:8px;
  padding:12px 30px;
  font-size:1rem;
  letter-spacing:1px;
  transition:all 0.25s ease;
  box-shadow:
    0 3px 6px rgba(0,0,0,0.7),
    inset 0 1px 0 rgba(255,255,255,0.12);
}
.billett-knapp:hover {
  color:#f5f5f5;
  background:linear-gradient(180deg,#343434 0%,#151515 100%);
  box-shadow:
    0 4px 8px rgba(0,0,0,0.9),
    0 0 10px rgba(255,255,255,0.25),
    0 0 12px rgba(255,255,255,0.25),
    inset 0 1px 1px rgba(255,255,255,0.15);
  transform:translateY(-2px);
}
.billett-knapp:active {
  background:linear-gradient(180deg,#1a1a1a 0%,#050505 100%);
  box-shadow:
    inset 0 2px 4px rgba(0,0,0,0.8),
    inset 0 -1px 0 rgba(255,255,255,0.1),
    0 0 5px rgba(230,57,70,0.5);
  transform:translateY(1px);
}

footer{text-align:center;padding:15px;border-top:2px solid #e63946;margin-top:50px;color:#aaa;}
html,body{height:100%;margin:0;padding:0;background:#111;}

@media (max-width:768px){
  .arr-detaljer{flex-direction:column;}
  main img{width:90%;}
}
html{overflow-y:scroll;}

.social-icons {
  position: absolute;
  top: 80%;
  right: 110px;
  transform: translateY(-50%);
  display: flex;
  gap: 12px;
  z-index: 50;
}
.social-icons img {
  width: 26px;
  height: 26px;
  object-fit: contain;
  border-radius: 5px;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.social-icons img:hover {
  transform: scale(1.15);
  box-shadow: 0 0 10px rgba(255,255,255,0.6);
}
/* Skjul sosiale medier når menyen er åpen */
.menu.show ~ .social-icons { display: none; }
</style>
</head>

<body>

<header>
  <img src="assets/logo_left.png" alt="Larvik Rockeklubb Logo" class="logo-left">
  <img src="assets/logo_midt.png" alt="Larvik Rockeklubb midtlogo" class="logo-center">

  <div class="burger" onclick="toggleMenu()">
    <span></span><span></span><span></span>
  </div>

  <nav id="dropdownMenu" class="menu">
    <a href="index.html" onclick="toggleMenu()">Hjem</a>
    <a href="index_arr_band-abc.html" onclick="toggleMenu()">Tilbake</a>
  </nav>
  <div class="social-icons">
    <img src="assets/facebook.png" alt="Facebook">
    <img src="assets/instagram.png" alt="Instagram">

  </div>
</header>

<section>
  <h1>Sabaton – Jotron Arena</h1>
  <div class="container">
    <form>
      <label>Navn:
        <input type="text" id="buyerName" placeholder="Ditt navn" required>
      </label>
      <label>E-post:
        <input type="email" id="buyerEmail" placeholder="Din e-post" required>
      </label>
      <label>Mobil:
        <input type="tel" id="buyerPhone" placeholder="Ditt mobilnummer" required>
      </label>
      <label>Antall:
        <input type="number" id="ticketQty" min="1" max="20" value="1" required>
      </label>

      <button type="submit">Bekreft kjøp</button>
    </form>
  </div>
</section>

<footer>
  &copy; 2025 Larvik Rockeklubb. Alle rettigheter forbeholdt.
</footer>

<script>
function toggleMenu(){
  document.getElementById("dropdownMenu").classList.toggle("show");
}
</script>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const params = new URLSearchParams(window.location.search);
  const eventId = params.get("eventId");
  if (!eventId) return;

  const API_BASE = "https://larvik-rockeklubb-backend.onrender.com";

  /* ===== HENT EVENT ===== */
  let ev;
  try {
    const resEvent = await fetch(`${API_BASE}/api/events/${eventId}`);
    if (!resEvent.ok) return;
    ev = await resEvent.json();
  } catch {
    return;
  }

  /* ===== OPPDATER TITTEL ===== */
  const h1 = document.querySelector("h1");
  if (h1) h1.textContent = `${ev.title} – ${ev.venue}`;

  /* ===== KOBLE FORM ===== */
  const form = document.querySelector("form");
  if (!form) return;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const name  = document.getElementById("buyerName").value.trim();
    const email = document.getElementById("buyerEmail").value.trim();
    const phone = document.getElementById("buyerPhone").value.trim();
    const qty   = parseInt(document.getElementById("ticketQty").value, 10);

    if (!name || !email || !qty) {
      alert("Fyll inn alle felter");
      return;
    }

    /* ===== OPPRETT ORDRE ===== */
    let data;
    try {
      const res = await fetch(`${API_BASE}/api/orders`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          eventId: ev.id,
          quantity: qty,
          email,
          name
        })
      });

      data = await res.json();
    } catch {
      alert("Serverfeil");
      return;
    }

    if (!data || !data.orderId) {
      alert("Kunne ikke opprette ordre");
      return;
    }

    /* ===== VIDERE TIL BETALING ===== */
    window.location.href =
      `index_betaling.html?orderId=${data.orderId}&name=${encodeURIComponent(name)}`;
  });
});
</script>

</body>
</html>
